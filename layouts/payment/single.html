{{ define "main" }}
<h1 style="text-align:center; color:#fff;">ðŸ’³ Payment</h1>

<div id="payment-container">
  <div id="checkout-summary">
    <h2>Order Summary</h2>
    <div id="order-items"></div>
    <p>Total: <strong id="order-total">$0.00</strong></p>
  </div>

  <form id="payment-form">
    <h2>Payment Details</h2>
    <label>Name on Card</label>
    <input type="text" id="card-name" required>

    <label>Card Number</label>
    <input type="text" id="card-number" maxlength="16" required>

    <label>Expiry Date</label>
    <input type="text" id="card-expiry" placeholder="MM/YY" required>

    <label>CVV</label>
    <input type="text" id="card-cvv" maxlength="3" required>

    <button type="submit">Complete Purchase</button>
  </form>
</div>

<style>
#payment-container {
  background: #1e293b;
  color: white;
  padding: 2rem;
  border-radius: 12px;
  max-width: 800px;
  margin: 2rem auto;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
}
#payment-form {
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
}
#payment-form input {
  padding: 0.6rem;
  border-radius: 6px;
  border: none;
}
#payment-form button {
  margin-top: 1rem;
  background: #22c55e;
  color: white;
  border: none;
  padding: 0.8rem 1.2rem;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
}
#payment-form button:hover {
  background: #16a34a;
}
#checkout-summary {
  background: #334155;
  padding: 1rem;
  border-radius: 8px;
}
#order-items div {
  display: flex;
  justify-content: space-between;
  margin: 0.5rem 0;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const checkoutCart = JSON.parse(localStorage.getItem("checkout_cart")) || [];
  const orderContainer = document.getElementById("order-items");
  const totalEl = document.getElementById("order-total");

  if (checkoutCart.length === 0) {
    orderContainer.innerHTML = "<p>Your cart is empty.</p>";
    return;
  }

  let total = 0;
  checkoutCart.forEach(item => {
    const div = document.createElement("div");
    div.innerHTML = `<span>${item.title} Ã— ${item.qty}</span><span>$${(item.price * item.qty).toFixed(2)}</span>`;
    orderContainer.appendChild(div);
    total += item.price * item.qty;
  });
  totalEl.textContent = `$${total.toFixed(2)}`;

  document.getElementById("payment-form").addEventListener("submit", (e) => {
    e.preventDefault();
    alert("âœ… Payment successful! Thank you for your purchase.");
    localStorage.removeItem("checkout_cart");

    // Also clear the user's cart
    const user = localStorage.getItem("user");
    const key = user ? `cart_${user}` : "cart";
    localStorage.removeItem(key);

    window.location.href = "/";
  });
});
</script>
{{ end }}
